machine:
  services:
    - docker
  node:
    version: 2.5.0
  environment:
    DEFAULT_REGION: US
    DATABASE_URL: postgres://ubuntu@127.0.0.1:5432/circle_test
    PORT: 3001
    REDIS_URL: redis://127.0.0.1:6379/2
deployment:
  hub:
    branch: circle
    commands:
      - docker build -t dnbrwstr/colorchat-server .
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push dnbrwstr/colorchat-server
      - |
        ssh core@colorchat-server.color.slow.so <<ENDSSH
        rolling-restart
        ENDSSH
